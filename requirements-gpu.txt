# ============================================================
# Data Science Agent - GPU-Accelerated Dependencies
# 150+ ML/AI Tools with CUDA Support
# ============================================================
#
# IMPORTANT: This file is for systems with NVIDIA GPUs and CUDA 12.x
# For CPU-only systems, use requirements.txt instead
#
# Prerequisites:
#   - NVIDIA GPU (RTX, Tesla, A100, H100, etc.)
#   - CUDA 12.x installed (12.1 or higher)
#   - NVIDIA drivers updated (>=525.60.13)
#   - cuDNN 8.x or higher
#
# Performance Gains with GPU:
#   - XGBoost: 5-10x faster training
#   - LightGBM: 3-8x faster training  
#   - PyTorch: 10-100x faster (depends on model size)
#   - FAISS: 10-50x faster similarity search
#   - CuPy: 10-100x faster array operations
#
# ============================================================

# Include all base dependencies
-r requirements.txt

# ============================
# GPU-Accelerated Overrides
# ============================

# PyTorch with CUDA 12.1 support
--extra-index-url https://download.pytorch.org/whl/cu121
torch>=2.5.1+cu121
torchaudio>=2.5.1+cu121
torchvision>=0.20.1+cu121

# XGBoost with GPU support
xgboost[gpu]>=2.1.3

# LightGBM with GPU support (requires CUDA and OpenCL)
# Note: May need separate installation on some systems
lightgbm>=4.5.0

# FAISS with GPU support (replaces faiss-cpu)
# Note: Uninstall faiss-cpu first: pip uninstall faiss-cpu
faiss-gpu>=1.9.0

# CuPy for GPU-accelerated NumPy operations (CUDA 12.x)
cupy-cuda12x>=13.3.0

# ============================
# Optional GPU Libraries
# ============================

# NVIDIA Rapids (GPU-accelerated data science libraries)
# Uncomment if you want GPU-accelerated pandas/sklearn:
# Note: Rapids requires specific CUDA versions and may have compatibility issues
# cudf-cu12>=24.10.0
# cuml-cu12>=24.10.0
# cugraph-cu12>=24.10.0

# TensorFlow with GPU support (optional, only if using TF models)
# tensorflow[and-cuda]>=2.18.0

# ============================================================
# Installation Instructions
# ============================================================
#
# Option 1: Using pip (Recommended)
#   # Remove CPU versions first
#   pip uninstall -y faiss-cpu
#   
#   # Install GPU versions
#   pip install -r requirements-gpu.txt
#
# Option 2: Using uv (Faster)
#   uv pip uninstall faiss-cpu
#   uv pip install -r requirements-gpu.txt
#
# Option 3: Automatic (Easiest)
#   python start_server.py
#   # Auto-detects GPU and installs correct versions
#
# ============================================================
# Verify GPU Installation
# ============================================================
#
# Run these commands to verify GPU is being used:
#
# 1. Check PyTorch CUDA
#   python -c "import torch; print(f'CUDA Available: {torch.cuda.is_available()}'); print(f'CUDA Version: {torch.version.cuda}'); print(f'GPU Device: {torch.cuda.get_device_name(0) if torch.cuda.is_available() else None}')"
#
# 2. Check XGBoost GPU
#   python -c "import xgboost; clf = xgboost.XGBClassifier(tree_method='gpu_hist'); print(f'XGBoost GPU: {clf.tree_method}')"
#
# 3. Check FAISS GPU
#   python -c "import faiss; print(f'FAISS GPU Count: {faiss.get_num_gpus()}')"
#
# 4. Check CuPy
#   python -c "import cupy as cp; print(f'CuPy CUDA Version: {cp.cuda.runtime.runtimeGetVersion()}'); print(f'GPU Device: {cp.cuda.Device().name.decode()}')"
#
# 5. Check LightGBM GPU (optional - may require additional setup)
#   python -c "import lightgbm as lgb; print(f'LightGBM version: {lgb.__version__}')"
#
# ============================================================
# Troubleshooting
# ============================================================
#
# If GPU is not detected:
# 1. Verify NVIDIA drivers: nvidia-smi
# 2. Check CUDA installation: nvcc --version
# 3. Reinstall PyTorch with CUDA:
#    pip install torch torchvision torchaudio --index-url https://download.pytorch.org/whl/cu121
# 4. Verify CUDA_PATH environment variable is set
# 5. On Windows, ensure CUDA bin directory is in PATH
#
# Common Issues:
# - CUDA version mismatch: Ensure CUDA 12.1+ is installed
# - Driver too old: Update NVIDIA drivers to >=525.60.13
# - Multiple CUDA versions: Set CUDA_PATH to correct version
# - Out of memory: Reduce batch sizes or use mixed precision training
#
# ============================================================
# Performance Tips
# ============================================================
#
# 1. Use GPU for these operations:
#    - Model training (XGBoost, LightGBM, PyTorch)
#    - FAISS similarity search
#    - Large matrix operations (CuPy)
#    - Image processing (torchvision)
#
# 2. Keep CPU for:
#    - Data loading and preprocessing
#    - Small datasets (<10K rows)
#    - Hyperparameter tuning (Optuna)
#
# 3. Mixed precision training:
#    - Use torch.cuda.amp for 2x speedup
#    - Reduces memory usage by 50%
#
# 4. Monitor GPU usage:
#    - nvidia-smi (command line)
#    - nvitop (better interface)
#    - Weights & Biases (W&B) for training monitoring
#
# ============================================================
# Updated: October 2025
# Tested with CUDA 12.1-12.6, NVIDIA Driver 545.xx+
# ============================================================
